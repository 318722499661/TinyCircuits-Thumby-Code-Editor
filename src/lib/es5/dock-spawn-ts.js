var DockSpawnTS;(()=>{"use strict";var e,t,i,n,s={d:(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},o={};s.r(o),s.d(o,{ContainerType:()=>e,Dialog:()=>g,DockConfig:()=>p,DockGraphSerializer:()=>v,DockLayoutEngine:()=>x,DockManager:()=>U,DockManagerContext:()=>z,DockModel:()=>P,DockNode:()=>f,DockWheel:()=>_,DockWheelItem:()=>T,DocumentManagerContainer:()=>B,DocumentTabPage:()=>L,DraggableContainer:()=>c,EventHandler:()=>h,FillDockContainer:()=>D,HorizontalDockContainer:()=>y,PanelContainer:()=>d,Point:()=>l,ResizableContainer:()=>m,ResizeHandle:()=>u,SplitterBar:()=>M,SplitterDockContainer:()=>k,SplitterPanel:()=>w,TabHandle:()=>E,TabHost:()=>C,TabPage:()=>H,UndockInitiator:()=>r,Utils:()=>a,VerticalDockContainer:()=>b}),function(e){e.horizontal="horizontal",e.vertical="vertical",e.fill="fill",e.panel="panel"}(e||(e={}));class l{constructor(e,t){this.x=e,this.y=t}}class a{static getPixels(e){return null===e?0:parseInt(e.replace("px",""))}static disableGlobalTextSelection(e){e.classList.add("disable-selection")}static enableGlobalTextSelection(e){e.classList.remove("disable-selection")}static isPointInsideNode(e,t,i){let n=i.container.containerElement.getBoundingClientRect();return e>=n.left&&e<=n.left+n.width&&t>=n.top&&t<=n.top+n.height}static getNextId(e){return e+a._counter++}static removeNode(e){return null!==e.parentNode&&(e.parentNode.removeChild(e),!0)}static orderByIndexes(e,t){let i=[];for(let n=0;n<t.length;n++)i.push(e[t[n]]);return i}static arrayRemove(e,t){let i=e.indexOf(t);return-1!==i&&e.splice(i,1)}static arrayContains(e,t){let i=e.length;for(;i--;)if(e[i]===t)return!0;return!1}static arrayEqual(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!=t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}}a._counter=0;class h{constructor(e,t,i,n){this.target=i,this.eventName=t,this.source=e,this.source.addEventListener(t,this.target,n)}cancel(){this.source.removeEventListener(this.eventName,this.target)}}class r{constructor(e,t,i){i||(i=7),this.element=e,this._undockededCallback=t,this.thresholdPixels=i,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._enabled?(this.mouseDownHandler&&(this.mouseDownHandler.cancel(),delete this.mouseDownHandler),this.touchDownHandler&&(this.touchDownHandler.cancel(),delete this.touchDownHandler),this.mouseDownHandler=new h(this.element,"mousedown",this.onMouseDown.bind(this)),this.touchDownHandler=new h(this.element,"touchstart",this.onMouseDown.bind(this),{passive:!1})):(this.mouseDownHandler&&(this.mouseDownHandler.cancel(),delete this.mouseDownHandler),this.touchDownHandler&&(this.touchDownHandler.cancel(),delete this.touchDownHandler),this.mouseUpHandler&&(this.mouseUpHandler.cancel(),delete this.mouseUpHandler),this.touchUpHandler&&(this.touchUpHandler.cancel(),delete this.touchUpHandler),this.mouseMoveHandler&&(this.mouseMoveHandler.cancel(),delete this.mouseMoveHandler),this.touchMoveHandler&&(this.touchMoveHandler.cancel(),delete this.touchMoveHandler))}onMouseDown(e){if(e.preventDefault(),this.enabled){if(e.touches){if(e.touches.length>1)return;e=e.touches[0]}this.mouseUpHandler&&(this.mouseUpHandler.cancel(),delete this.mouseUpHandler),this.touchUpHandler&&(this.touchUpHandler.cancel(),delete this.touchUpHandler),this.mouseMoveHandler&&(this.mouseMoveHandler.cancel(),delete this.mouseMoveHandler),this.touchMoveHandler&&(this.touchMoveHandler.cancel(),delete this.touchMoveHandler),this.mouseUpHandler=new h(window,"mouseup",this.onMouseUp.bind(this)),this.touchUpHandler=new h(window,"touchend",this.onMouseUp.bind(this)),this.mouseMoveHandler=new h(window,"mousemove",this.onMouseMove.bind(this)),this.touchMoveHandler=new h(window,"touchmove",this.onMouseMove.bind(this)),this.dragStartPosition=new l(e.clientX,e.clientY)}}onMouseUp(){this.mouseUpHandler&&(this.mouseUpHandler.cancel(),delete this.mouseUpHandler),this.touchUpHandler&&(this.touchUpHandler.cancel(),delete this.touchUpHandler),this.mouseMoveHandler&&(this.mouseMoveHandler.cancel(),delete this.mouseMoveHandler),this.touchMoveHandler&&(this.touchMoveHandler.cancel(),delete this.touchMoveHandler)}onMouseMove(e){if(e.touches){if(e.touches.length>1)return;e=e.touches[0]}let t=new l(e.clientX,e.clientY).y-this.dragStartPosition.y;(t>this.thresholdPixels||t<-this.thresholdPixels)&&(this.enabled=!1,this._requestUndock(e))}_requestUndock(e){let t=0,i=0,n=this.element;do{t+=n.offsetTop||0,i+=n.offsetLeft||0,n=n.offsetParent}while(n);let s=this.dragStartPosition.x-i,o=this.dragStartPosition.y-t,a=new l(s,o);this._undockededCallback(e,a)}}!function(e){e.document="document",e.panel="panel"}(t||(t={}));class d{constructor(i,n,s,o,l){s||(s="Panel"),o||(o=t.panel),this.panelType=o,this.elementContent=Object.assign(i,{_dockSpawnPanelContainer:this}),this.dockManager=n,this.title=s,this.containerType=e.panel,this.icon=null,this.minimumAllowedChildNodes=0,this._floatingDialog=void 0,this.isDialog=!1,this._canUndock=n._undockEnabled,this.eventListeners=[],this._hideCloseButton=l,this._initialize()}canUndock(e){this._canUndock=e,this.undockInitiator.enabled=e,this.eventListeners.forEach((t=>{t.onDockEnabled&&t.onDockEnabled({self:this,state:e})}))}addListener(e){this.eventListeners.push(e)}removeListener(e){this.eventListeners.splice(this.eventListeners.indexOf(e),1)}get floatingDialog(){return this._floatingDialog}set floatingDialog(e){this._floatingDialog=e;let t=void 0===this._floatingDialog;this.undockInitiator.enabled=t}static loadFromState(e,t){let i=e.element,n=document.getElementById(i);if(null===n)return null;let s=new d(n,t);return s.loadState(e),s}saveState(e){e.element=this.elementContent.id,e.width=this.width,e.height=this.height,e.canUndock=this._canUndock,e.hideCloseButton=this._hideCloseButton,e.panelType=this.panelType}loadState(e){this.width=e.width,this.height=e.height,this.state={width:e.width,height:e.height},this.canUndock(e.canUndock),this.hideCloseButton(e.hideCloseButton),this.panelType=e.panelType}setActiveChild(){}get containerElement(){return this.elementPanel}_initialize(){this.name=a.getNextId("panel_"),this.elementPanel=document.createElement("div"),this.elementPanel.tabIndex=0,this.elementTitle=document.createElement("div"),this.elementTitleText=document.createElement("div"),this.elementContentHost=document.createElement("div"),this.elementButtonClose=document.createElement("div"),this.elementPanel.appendChild(this.elementTitle),this.elementTitle.appendChild(this.elementTitleText),this.elementTitle.appendChild(this.elementButtonClose),this.elementButtonClose.classList.add("panel-titlebar-button-close"),this.elementButtonClose.style.display=this._hideCloseButton?"none":"block",this.elementPanel.appendChild(this.elementContentHost),this.elementPanel.classList.add("panel-base"),this.elementTitle.classList.add("panel-titlebar"),this.elementTitle.classList.add("disable-selection"),this.elementTitleText.classList.add("panel-titlebar-text"),this.elementContentHost.classList.add("panel-content");let e=this.elementContent.clientWidth,t=this.elementContent.clientHeight,i=this.elementTitle.clientHeight;this._setPanelDimensions(e,t+i),this._hideCloseButton||(this.closeButtonClickedHandler=new h(this.elementButtonClose,"click",this.onCloseButtonClicked.bind(this)),this.closeButtonTouchedHandler=new h(this.elementButtonClose,"touchstart",this.onCloseButtonClicked.bind(this))),a.removeNode(this.elementContent),this.elementContentHost.appendChild(this.elementContent);let n=this.elementContent.dataset.panelCaption,s=this.elementContent.dataset.panelIcon;n&&(this.title=n),s&&(this.icon=s),this._updateTitle(),this.undockInitiator=new r(this.elementTitle,this.performUndockToDialog.bind(this)),delete this.floatingDialog,this.mouseDownHandler=new h(this.elementPanel,"mousedown",this.onMouseDown.bind(this)),this.touchDownHandler=new h(this.elementPanel,"touchstart",this.onMouseDown.bind(this)),this.elementContent.removeAttribute("hidden")}onMouseDown(){this.dockManager.activePanel=this}hideCloseButton(e){this._hideCloseButton=e,this.elementButtonClose.style.display=e?"none":"block",this.eventListeners.forEach((t=>{t.onHideCloseButton&&t.onHideCloseButton({self:this,state:e})}))}destroy(){this.mouseDownHandler&&(this.mouseDownHandler.cancel(),delete this.mouseDownHandler),this.touchDownHandler&&(this.touchDownHandler.cancel(),delete this.touchDownHandler),a.removeNode(this.elementPanel),this.closeButtonClickedHandler&&(this.closeButtonClickedHandler.cancel(),delete this.closeButtonClickedHandler),this.closeButtonTouchedHandler&&(this.closeButtonTouchedHandler.cancel(),delete this.closeButtonTouchedHandler)}performUndockToDialog(e,t){return this.isDialog=!0,this.undockInitiator.enabled=!1,this.elementContent.style.display="block",this.elementPanel.style.position="",this.dockManager.requestUndockToDialog(this,e,t)}performClose(){this.isDialog=!0,this.undockInitiator.enabled=!1,this.elementContent.style.display="block",this.elementPanel.style.position="",this.dockManager.requestClose(this)}performUndock(){this.undockInitiator.enabled=!1,this.dockManager.requestUndock(this)}prepareForDocking(){this.isDialog=!1,this.undockInitiator.enabled=this._canUndock}get width(){return this._cachedWidth}set width(e){e!==this._cachedWidth&&(this._cachedWidth=e,this.elementPanel.style.width=e+"px")}get height(){return this._cachedHeight}set height(e){e!==this._cachedHeight&&(this._cachedHeight=e,this.elementPanel.style.height=e+"px")}resize(e,t){this._setPanelDimensions(e,t),this._cachedWidth=e,this._cachedHeight=t;try{null!=this.elementContent&&"function"==typeof this.elementContent.resizeHandler&&this.elementContent.resizeHandler(e,t-this.elementTitle.clientHeight)}catch(e){console.log("error calling resizeHandler:",e," elt:",this.elementContent)}}_setPanelDimensions(e,t){this.elementTitle.style.width=e+"px",this.elementContentHost.style.width=e+"px",this.elementContent.style.width=e+"px",this.elementPanel.style.width=e+"px";let i=t-this.elementTitle.clientHeight;this.elementContentHost.style.height=i+"px",this.elementContent.style.height=i+"px",this.elementPanel.style.height=t+"px"}setTitle(e){this.title=e,this._updateTitle(),this.onTitleChanged&&this.onTitleChanged(this,e)}setTitleIcon(e){this.icon=e,this._updateTitle(),this.onTitleChanged&&this.onTitleChanged(this,this.title)}setCloseIconTemplate(e){this.elementButtonClose.innerHTML=e}_updateTitle(){null===this.icon?this.elementTitleText.innerHTML=this.title:this.elementTitleText.innerHTML='<img class="panel-titlebar-icon" src="'+this.icon+'"><span>'+this.title+"</span>"}getRawTitle(){return this.elementTitleText.innerHTML}performLayout(e,t){}onCloseButtonClicked(){this.close()}close(){this.isDialog?this.floatingDialog&&this.floatingDialog.close():(this.performClose(),this.dockManager.notifyOnClosePanel(this))}}class c{constructor(e,t,i,n){this.dialog=e,this.delegate=t,this.containerElement=t.containerElement,this.dockManager=t.dockManager,this.topLevelElement=i,this.containerType=t.containerType,this.mouseDownHandler=new h(n,"mousedown",this.onMouseDown.bind(this)),this.touchDownHandler=new h(n,"touchstart",this.onMouseDown.bind(this)),this.topLevelElement.style.marginLeft=i.offsetLeft+"px",this.topLevelElement.style.marginTop=i.offsetTop+"px",this.minimumAllowedChildNodes=t.minimumAllowedChildNodes,this.iframeEventHandlers=[]}destroy(){this.removeDecorator(),this.delegate.destroy()}saveState(e){this.delegate.saveState(e)}loadState(e){this.delegate.loadState(e)}setActiveChild(){}get width(){return this.delegate.width}get height(){return this.delegate.height}get name(){return this.delegate.name}set name(e){e&&(this.delegate.name=e)}resize(e,t){this.delegate.resize(e,t)}performLayout(e){this.delegate.performLayout(e,!1)}removeDecorator(){this.mouseDownHandler&&(this.mouseDownHandler.cancel(),delete this.mouseDownHandler),this.touchDownHandler&&(this.touchDownHandler.cancel(),delete this.touchDownHandler)}onMouseDown(e){e.preventDefault&&e.preventDefault();let t=null;if(e.touches){if(e.touches.length>1)return;t=e.touches[0]}else t=e;if(this._startDragging(t),this.previousMousePosition={x:t.clientX,y:t.clientY},this.mouseMoveHandler&&(this.mouseMoveHandler.cancel(),delete this.mouseMoveHandler),this.touchMoveHandler&&(this.touchMoveHandler.cancel(),delete this.touchMoveHandler),this.mouseUpHandler&&(this.mouseUpHandler.cancel(),delete this.mouseUpHandler),this.touchUpHandler&&(this.touchUpHandler.cancel(),delete this.touchUpHandler),this.mouseMoveHandler=new h(window,"mousemove",this.onMouseMove.bind(this)),this.touchMoveHandler=new h(e.target,"touchmove",this.onMouseMove.bind(this),{passive:!1}),this.mouseUpHandler=new h(window,"mouseup",this.onMouseUp.bind(this)),this.touchUpHandler=new h(e.target,"touchend",this.onMouseUp.bind(this)),this.dockManager.iframes)for(let e of this.dockManager.iframes){let t=this.onMouseMovedIframe.bind(this);this.iframeEventHandlers.push(new h(e.contentWindow,"mousemove",(i=>t(i,e)))),this.iframeEventHandlers.push(new h(e.contentWindow,"mouseup",this.onMouseUp.bind(this))),this.iframeEventHandlers.push(new h(e.contentWindow,"touchmove",(i=>t(i,e)))),this.iframeEventHandlers.push(new h(e.contentWindow,"touchend",this.onMouseUp.bind(this)))}}onMouseUp(e){this._stopDragging(e),this.mouseMoveHandler.cancel(),delete this.mouseMoveHandler,this.touchMoveHandler.cancel(),delete this.touchMoveHandler,this.mouseUpHandler.cancel(),delete this.mouseUpHandler,this.touchUpHandler.cancel(),delete this.touchUpHandler;for(let e of this.iframeEventHandlers)e.cancel();this.iframeEventHandlers=[]}_startDragging(e){this.containerElement.classList.add("draggable-dragging-active"),this.dialog.eventListener&&this.dialog.eventListener._onDialogDragStarted(this.dialog,e),a.disableGlobalTextSelection(this.dockManager.config.dialogRootElement)}_stopDragging(e){this.containerElement.classList.remove("draggable-dragging-active"),this.dialog.eventListener&&this.dialog.eventListener._onDialogDragEnded(this.dialog,e),a.enableGlobalTextSelection(this.dockManager.config.dialogRootElement)}onMouseMovedIframe(e,t){let i=t.getBoundingClientRect();this.onMouseMove(e,{x:i.x,y:i.y})}onMouseMove(e,t){e.preventDefault&&e.preventDefault();let i=document.body.getBoundingClientRect();if(null!=e.touches){if(e.touches.length>1)return;for(let t in this.dockManager.dockWheel.wheelItems){let n=this.dockManager.dockWheel.wheelItems[t],s=n.element.getBoundingClientRect();e.touches[0].clientX>s.left-i.left&&e.touches[0].clientX<s.left+n.element.clientWidth-i.left&&e.touches[0].clientY>s.top-i.top&&e.touches[0].clientY<s.top+n.element.clientHeight-i.top?n.onMouseMoved():n.active&&n.onMouseOut()}}let n=null;if(e.changedTouches){if(e.changedTouches.length>1)return;n=e.changedTouches[0]}else n=e;let s=new l(n.clientX,n.clientY);t&&(s=new l(n.clientX+t.x,n.clientY+t.y));let o=this.dockManager.checkXBounds(this.topLevelElement,s,this.previousMousePosition,!1,!1),a=this.dockManager.checkYBounds(this.topLevelElement,s,this.previousMousePosition,!1,!1);this._performDrag(o,a),this.previousMousePosition=s}_performDrag(e,t){let i=e+a.getPixels(this.topLevelElement.style.marginLeft),n=t+a.getPixels(this.topLevelElement.style.marginTop);this.topLevelElement.style.marginLeft=i+"px",this.topLevelElement.style.marginTop=n+"px"}}class u{constructor(){this.element=void 0,this.handleSize=6,this.cornerSize=12,this.east=!1,this.west=!1,this.north=!1,this.south=!1,this.corner=!1}adjustSize(e,t){this.corner?(this.west&&(this.element.style.left="0px"),this.east&&(this.element.style.left=e-this.cornerSize+"px"),this.north&&(this.element.style.top="0px"),this.south&&(this.element.style.top=t-this.cornerSize+"px")):(this.west&&(this.element.style.left="0px",this.element.style.top=this.cornerSize+"px"),this.east&&(this.element.style.left=e-this.handleSize+"px",this.element.style.top=this.cornerSize+"px"),this.north&&(this.element.style.left=this.cornerSize+"px",this.element.style.top="0px"),this.south&&(this.element.style.left=this.cornerSize+"px",this.element.style.top=t-this.handleSize+"px"),this.west||this.east?this.element.style.height=t-2*this.cornerSize+"px":this.element.style.width=e-2*this.cornerSize+"px")}}class m{constructor(e,t,i){this.dialog=e,this.delegate=t,this.containerElement=t.containerElement,this.dockManager=t.dockManager,this.topLevelElement=i,this.containerType=t.containerType,this.topLevelElement.style.marginLeft=this.topLevelElement.offsetLeft+"px",this.topLevelElement.style.marginTop=this.topLevelElement.offsetTop+"px",this.minimumAllowedChildNodes=t.minimumAllowedChildNodes,this._buildResizeHandles(),this.readyToProcessNextResize=!0,this.dockSpawnResizedEvent=new CustomEvent("DockSpawnResizedEvent",{composed:!0,bubbles:!0}),this.iframeEventHandlers=[]}setActiveChild(){}_buildResizeHandles(){this.resizeHandles=[],this._buildResizeHandle(!1,!0,!0,!1),this._buildResizeHandle(!0,!1,!1,!0),this._buildResizeHandle(!1,!0,!1,!0),this._buildResizeHandle(!0,!1,!1,!1),this._buildResizeHandle(!1,!0,!1,!1),this._buildResizeHandle(!1,!1,!0,!1),this._buildResizeHandle(!1,!1,!1,!0)}_buildResizeHandle(e,t,i,n){let s=new u;s.east=e,s.west=t,s.north=i,s.south=n,s.element=document.createElement("div"),this.topLevelElement.appendChild(s.element);let o="",l="";i&&(o="n"),n&&(o="s"),e&&(l="e"),t&&(l="w");let a="resize-handle-"+o+l;o.length>0&&l.length>0&&(s.corner=!0),s.element.classList.add(s.corner?"resize-handle-corner":"resize-handle"),s.element.classList.add(a),this.resizeHandles.push(s),s.mouseDownHandler=new h(s.element,"mousedown",(e=>{this.onMouseDown(s,e)})),s.touchDownHandler=new h(s.element,"touchstart",(e=>{this.onMouseDown(s,e)}))}saveState(e){this.delegate.saveState(e)}loadState(e){this.delegate.loadState(e)}get width(){return this.delegate.width}get height(){return this.delegate.height}get name(){return this.delegate.name}set name(e){e&&(this.delegate.name=e)}resize(e,t){this.delegate.resize(e,t),this._adjustResizeHandles(e,t),document.dispatchEvent(this.dockSpawnResizedEvent)}_adjustResizeHandles(e,t){this.resizeHandles.forEach((i=>{i.adjustSize(e,t)}))}performLayout(e){this.delegate.performLayout(e,!1)}destroy(){this.removeDecorator(),this.delegate.destroy()}removeDecorator(){}onMouseMovedIframe(e,t,i){let n=i.getBoundingClientRect();this.onMouseMoved(e,t,{x:n.x,y:n.y})}onMouseMoved(e,t,i){let n=null;if(t.changedTouches){if(t.changedTouches.length>1)return;n=t.changedTouches[0]}else n=t;if(!this.readyToProcessNextResize)return;this.readyToProcessNextResize=!1,this.dialog.panel&&this.dockManager.suspendLayout(this.dialog.panel);let s=new l(n.clientX,n.clientY);i&&(s=new l(n.clientX+i.x,n.clientY+i.y));let o=this.dockManager.checkXBounds(this.topLevelElement,s,this.previousMousePosition,e.west,e.east),a=this.dockManager.checkYBounds(this.topLevelElement,s,this.previousMousePosition,e.north,e.south);this._performDrag(e,o,a),this.previousMousePosition=s,this.readyToProcessNextResize=!0,this.dialog.panel&&this.dockManager.resumeLayout(this.dialog.panel),this.dockManager.notifyOnContainerResized(this)}onMouseDown(e,t){let i=null;if(t.touches){if(t.touches.length>1)return;i=t.touches[0]}else i=t;this.previousMousePosition=new l(i.clientX,i.clientY),e.mouseMoveHandler&&(e.mouseMoveHandler.cancel(),delete e.mouseMoveHandler),e.touchMoveHandler&&(e.touchMoveHandler.cancel(),delete e.touchMoveHandler),e.mouseUpHandler&&(e.mouseUpHandler.cancel(),delete e.mouseUpHandler),e.touchUpHandler&&(e.touchUpHandler.cancel(),delete e.touchUpHandler);for(let e of this.iframeEventHandlers)e.cancel();if(this.iframeEventHandlers=[],e.mouseMoveHandler=new h(window,"mousemove",(t=>{this.onMouseMoved(e,t)})),e.touchMoveHandler=new h(window,"touchmove",(t=>{this.onMouseMoved(e,t)})),e.mouseUpHandler=new h(window,"mouseup",(t=>{this.onMouseUp(e)})),e.touchUpHandler=new h(window,"touchend",(t=>{this.onMouseUp(e)})),this.dockManager.iframes)for(let t of this.dockManager.iframes){let i=this.onMouseMovedIframe.bind(this);this.iframeEventHandlers.push(new h(t.contentWindow,"mousemove",(n=>i(e,n,t)))),this.iframeEventHandlers.push(new h(t.contentWindow,"mouseup",(t=>this.onMouseUp(e)))),this.iframeEventHandlers.push(new h(t.contentWindow,"touchmove",(n=>i(e,n,t)))),this.iframeEventHandlers.push(new h(t.contentWindow,"touchend",(t=>this.onMouseUp(e))))}a.disableGlobalTextSelection(this.dockManager.config.dialogRootElement)}onMouseUp(e){e.mouseMoveHandler.cancel(),e.touchMoveHandler.cancel(),e.mouseUpHandler.cancel(),e.touchUpHandler.cancel(),delete e.mouseMoveHandler,delete e.touchMoveHandler,delete e.mouseUpHandler,delete e.touchUpHandler;for(let e of this.iframeEventHandlers)e.cancel();this.iframeEventHandlers=[],a.enableGlobalTextSelection(this.dockManager.config.dialogRootElement)}_performDrag(e,t,i){let n={};n.left=a.getPixels(this.topLevelElement.style.marginLeft),n.top=a.getPixels(this.topLevelElement.style.marginTop),n.width=this.topLevelElement.clientWidth,n.height=this.topLevelElement.clientHeight,e.east&&this._resizeEast(t,n),e.west&&this._resizeWest(t,n),e.north&&this._resizeNorth(i,n),e.south&&this._resizeSouth(i,n)}_resizeWest(e,t){this._resizeContainer(e,0,-e,0,t)}_resizeEast(e,t){this._resizeContainer(0,0,e,0,t)}_resizeNorth(e,t){this._resizeContainer(0,e,0,-e,t)}_resizeSouth(e,t){this._resizeContainer(0,0,0,e,t)}_resizeContainer(e,t,i,n,s){s.left+=e,s.top+=t,s.width+=i,s.height+=n,s.width=Math.max(s.width,50),s.height=Math.max(s.height,50),this.topLevelElement.style.marginLeft=s.left+"px",this.topLevelElement.style.marginTop=s.top+"px",this.resize(s.width,s.height)}}class g{constructor(e,t){this.panel=e,this.dockManager=t,this.eventListener=t,this._initialize(),this.dockManager.context.model.dialogs.push(this),this.position=t.defaultDialogPosition,this.dockManager.notifyOnCreateDialog(this),e.isDialog=!0}saveState(e,t){this.position=new l(e,t),this.dockManager.notifyOnChangeDialogPosition(this,e,t)}static fromElement(e,t){return new g(new d(document.getElementById(e),t),t)}_initialize(){this.panel.floatingDialog=this,this.elementDialog=Object.assign(document.createElement("div"),{floatingDialog:this}),this.elementDialog.tabIndex=0,this.elementDialog.appendChild(this.panel.elementPanel),this.draggable=new c(this,this.panel,this.elementDialog,this.panel.elementTitle),this.resizable=new m(this,this.draggable,this.draggable.topLevelElement),this.dockManager.config.dialogRootElement.appendChild(this.elementDialog),this.elementDialog.classList.add("dialog-floating"),this.focusHandler=new h(this.elementDialog,"focus",this.onFocus.bind(this),!0),this.mouseDownHandler=new h(this.elementDialog,"mousedown",this.onMouseDown.bind(this),!0),this.touchDownHandler=new h(this.elementDialog,"touchstart",this.onMouseDown.bind(this)),this.keyPressHandler=new h(this.elementDialog,"keypress",this.dockManager.onKeyPressBound,!0),this.resize(this.panel.elementPanel.clientWidth,this.panel.elementPanel.clientHeight),this.isHidden=!1,this.bringToFront()}setPosition(e,t){let i=this.dockManager.config.dialogRootElement.getBoundingClientRect();this.position=new l(e-i.left,t-i.top),this.elementDialog.style.left=e-i.left+"px",this.elementDialog.style.top=t-i.top+"px",this.dockManager.notifyOnChangeDialogPosition(this,e,t)}getPosition(){return new l(this.position?this.position.x:0,this.position?this.position.y:0)}onFocus(){this.dockManager.activePanel!=this.panel&&(this.dockManager.activePanel=this.panel)}onMouseDown(){this.bringToFront()}destroy(){this.focusHandler&&(this.focusHandler.cancel(),delete this.focusHandler),this.mouseDownHandler&&(this.mouseDownHandler.cancel(),delete this.mouseDownHandler),this.touchDownHandler&&(this.touchDownHandler.cancel(),delete this.touchDownHandler),this.keyPressHandler&&(this.keyPressHandler.cancel(),delete this.keyPressHandler),a.removeNode(this.elementDialog),this.draggable.removeDecorator(),a.removeNode(this.panel.elementPanel),a.arrayRemove(this.dockManager.context.model.dialogs,this),delete this.panel.floatingDialog}resize(e,t){this.resizable.resize(e,t)}setTitle(e){this.panel.setTitle(e)}setTitleIcon(e){this.panel.setTitleIcon(e)}bringToFront(){this.elementDialog.style.zIndex=this.dockManager.zIndexDialogCounter++,this.dockManager.activePanel=this.panel}hide(){this.elementDialog.style.zIndex="0",this.elementDialog.style.display="none",this.isHidden||(this.isHidden=!0,this.dockManager.notifyOnHideDialog(this))}close(){this.hide(),this.remove(),this.dockManager.notifyOnClosePanel(this.panel),this.destroy()}remove(){this.elementDialog.parentNode.removeChild(this.elementDialog)}show(){this.elementDialog.style.zIndex=this.dockManager.zIndexDialogCounter++,this.elementDialog.style.display="block",this.isHidden&&(this.isHidden=!1,this.dockManager.notifyOnShowDialog(this))}}class p{constructor(){this.escClosesWindow=!0,this.escClosesDialog=!0,this.dialogRootElement=document.body,this.moveOnlyWithinDockConatiner=!1}}class v{serialize(e){let t=this._buildGraphInfo(e.rootNode),i=this._buildDialogsInfo(e.dialogs.sort(((e,t)=>e.elementDialog.style.zIndex-t.elementDialog.style.zIndex)));return JSON.stringify({graphInfo:t,dialogsInfo:i})}_buildGraphInfo(e){let t={};e.container.saveState(t);let i=[];return e.children.forEach((e=>{i.push(this._buildGraphInfo(e))})),{containerType:e.container.containerType,state:t,children:i}}_buildDialogsInfo(e){let t=[];return e.forEach((e=>{let i={},n=e.panel;n.saveState(i);let s={containerType:n.containerType,state:i,position:e.getPosition(),isHidden:e.isHidden};t.push(s)})),t}}class f{constructor(e){this.container=e,this.children=[]}detachFromParent(){this.parent&&(this.parent.removeChild(this),delete this.parent)}removeChild(e){let t=this.children.indexOf(e);t>=0&&this.children.splice(t,1)}addChild(e){e.detachFromParent(),e.parent=this,this.children.push(e)}addChildBefore(e,t){this._addChildWithDirection(e,t,!0)}addChildAfter(e,t){this._addChildWithDirection(e,t,!1)}_addChildWithDirection(e,t,i){t.detachFromParent(),t.parent=this;let n=this.children.indexOf(e),s=this.children.slice(0,n),o=this.children.slice(n+1,this.children.length);this.children=s.slice(0),i?(this.children.push(t),this.children.push(e)):(this.children.push(e),this.children.push(t)),Array.prototype.push.apply(this.children,o)}performLayout(e){let t=this.children.map((e=>e.container));this.container.performLayout(t,e)}debugDumpTree(e){void 0===e&&(e=0);let t=this.container.name;for(let i=0;i<e;i++)t="\t"+t;let i=void 0===this.parent?"null":this.parent.container.containerType;console.log(">>"+t+" ["+i+"]"),this.children.forEach((t=>{t.debugDumpTree(e+1)}))}}class M{constructor(e,t,i){this.previousContainer=e,this.nextContainer=t,this.stackedVertical=i,this.barElement=document.createElement("div"),this.barElement.classList.add(i?"splitbar-horizontal":"splitbar-vertical"),this.mouseDownHandler=new h(this.barElement,"mousedown",this.onMouseDown.bind(this)),this.touchDownHandler=new h(this.barElement,"touchstart",this.onMouseDown.bind(this)),this.minPanelSize=50,this.readyToProcessNextDrag=!0,this.dockSpawnResizedEvent=new CustomEvent("DockSpawnResizedEvent",{composed:!0,bubbles:!0}),this.iframeEventHandlers=[]}onMouseDown(e){if(e.touches){if(e.touches.length>1)return;e=e.touches[0]}this._startDragging(e)}onMouseUp(){this._stopDragging()}onMouseMovedIframe(e,t){null!=e.changedTouches&&(e=e.changedTouches[0]);let i=t.getBoundingClientRect();this.handleMoveEvent({x:e.clientX+i.x,y:e.clientY+i.y})}onMouseMoved(e){null!=e.changedTouches&&(e=e.changedTouches[0]),this.handleMoveEvent({x:e.clientX,y:e.clientY})}handleMoveEvent(e){if(!this.readyToProcessNextDrag)return;this.readyToProcessNextDrag=!1;let t=this.previousContainer.dockManager;t.suspendLayout(this.previousContainer),t.suspendLayout(this.nextContainer);let i=e.x-this.previousMouseEvent.x,n=e.y-this.previousMouseEvent.y;this._performDrag(i,n),this.previousMouseEvent=e,this.readyToProcessNextDrag=!0,t.resumeLayout(this.previousContainer),t.resumeLayout(this.nextContainer)}_performDrag(e,t){let i=this.previousContainer.containerElement.clientWidth,n=this.previousContainer.containerElement.clientHeight,s=this.nextContainer.containerElement.clientWidth,o=this.nextContainer.containerElement.clientHeight,l=this.stackedVertical?n:i,a=this.stackedVertical?o:s,h=this.stackedVertical?t:e,r=l+h,d=a-h;(!(r<this.minPanelSize||d<this.minPanelSize)||r<this.minPanelSize&&r>l||d<this.minPanelSize&&d>a)&&(this.stackedVertical?(this.previousContainer.resize(i,r),this.nextContainer.resize(s,d)):(this.previousContainer.resize(r,n),this.nextContainer.resize(d,o)),document.dispatchEvent(this.dockSpawnResizedEvent))}_startDragging(e){if(a.disableGlobalTextSelection(this.previousContainer.dockManager.config.dialogRootElement),this.mouseMovedHandler&&(this.mouseMovedHandler.cancel(),delete this.mouseMovedHandler),this.touchMovedHandler&&(this.touchMovedHandler.cancel(),delete this.touchMovedHandler),this.mouseUpHandler&&(this.mouseUpHandler.cancel(),delete this.mouseUpHandler),this.touchUpHandler&&(this.touchUpHandler.cancel(),delete this.touchUpHandler),this.mouseMovedHandler=new h(window,"mousemove",this.onMouseMoved.bind(this)),this.mouseUpHandler=new h(window,"mouseup",this.onMouseUp.bind(this)),this.touchMovedHandler=new h(window,"touchmove",this.onMouseMoved.bind(this)),this.touchUpHandler=new h(window,"touchend",this.onMouseUp.bind(this)),this.previousContainer.dockManager.iframes)for(let e of this.previousContainer.dockManager.iframes){let t=this.onMouseMovedIframe.bind(this);this.iframeEventHandlers.push(new h(e.contentWindow,"mousemove",(i=>t(i,e)))),this.iframeEventHandlers.push(new h(e.contentWindow,"mouseup",this.onMouseUp.bind(this))),this.iframeEventHandlers.push(new h(e.contentWindow,"touchmove",(i=>t(i,e)))),this.iframeEventHandlers.push(new h(e.contentWindow,"touchend",this.onMouseUp.bind(this)))}this.previousMouseEvent={x:e.clientX,y:e.clientY}}_stopDragging(){a.enableGlobalTextSelection(this.previousContainer.dockManager.config.dialogRootElement),this.mouseMovedHandler&&(this.mouseMovedHandler.cancel(),delete this.mouseMovedHandler),this.touchMovedHandler&&(this.touchMovedHandler.cancel(),delete this.touchMovedHandler),this.mouseUpHandler&&(this.mouseUpHandler.cancel(),delete this.mouseUpHandler),this.touchUpHandler&&(this.touchUpHandler.cancel(),delete this.touchUpHandler);for(let e of this.iframeEventHandlers)e.cancel();this.iframeEventHandlers=[]}}class w{constructor(e,t){this.childContainers=e,this.stackedVertical=t,this.panelElement=document.createElement("div"),this.spiltterBars=[],this._buildSplitterDOMAndAddElements()}_buildSplitterDOMAndAddElements(){if(this.childContainers.length<=1)throw new Error("Splitter panel should contain atleast 2 panels");this.spiltterBars=[];let e=null;for(let t=0;t<this.childContainers.length-1;t++){let i=this.childContainers[t],n=this.childContainers[t+1],s=new M(i,n,this.stackedVertical);this.spiltterBars.push(s),Array.from(this.panelElement.children).includes(i.containerElement)||this._insertContainerIntoPanel(i,e),this.panelElement.insertBefore(s.barElement,i.containerElement.nextSibling),e=s.barElement}let t=this.childContainers.slice(-1)[0];Array.from(this.panelElement.children).includes(t.containerElement)||this._insertContainerIntoPanel(t,e)}performLayout(e,t){a.arrayEqual(this.childContainers,e)&&!t||(this.childContainers.forEach((t=>{e.some((e=>e==t))||t.containerElement&&(t.containerElement.classList.remove("splitter-container-vertical"),t.containerElement.classList.remove("splitter-container-horizontal"),a.removeNode(t.containerElement))})),this.spiltterBars.forEach((e=>{a.removeNode(e.barElement)})),this.childContainers=e,this._buildSplitterDOMAndAddElements())}removeFromDOM(){this.childContainers.forEach((e=>{e.containerElement&&(e.containerElement.classList.remove("splitter-container-vertical"),e.containerElement.classList.remove("splitter-container-horizontal"),a.removeNode(e.containerElement))})),this.spiltterBars.forEach((e=>{a.removeNode(e.barElement)}))}destroy(){this.removeFromDOM(),this.panelElement.parentNode.removeChild(this.panelElement)}_insertContainerIntoPanel(e,t){e?(e.containerElement.parentNode!=this.panelElement&&(a.removeNode(e.containerElement),t?this.panelElement.insertBefore(e.containerElement,t.nextSibling):this.panelElement.children.length>0?this.panelElement.insertBefore(e.containerElement,this.panelElement.children[0]):this.panelElement.appendChild(e.containerElement)),e.containerElement.classList.add(this.stackedVertical?"splitter-container-vertical":"splitter-container-horizontal")):console.error("container is undefined")}setContainerRatio(e,t){let i=this.stackedVertical?this.panelElement.clientHeight:this.panelElement.clientWidth,n=i*t,s=(i-n-(this.stackedVertical?this.spiltterBars[0].barElement.clientHeight:this.spiltterBars[0].barElement.clientWidth)*this.spiltterBars.length)/i;for(let t=0;t<this.childContainers.length;t++){let i,o=this.childContainers[t];o!==e?(i=this.stackedVertical?o.containerElement.parentElement.clientHeight:o.containerElement.parentElement.clientWidth,i*=s):i=n,this.stackedVertical?o.resize(o.width,Math.floor(i)):o.resize(Math.floor(i),o.height)}}getRatios(){let e=this.stackedVertical?this.spiltterBars[0].barElement.clientHeight:this.spiltterBars[0].barElement.clientWidth,t=(this.stackedVertical?this.panelElement.clientHeight:this.panelElement.clientWidth)-e*this.spiltterBars.length,i=[];for(let e=0;e<this.childContainers.length;e++){let n=this.childContainers[e],s=this.stackedVertical?n.containerElement.clientHeight:n.containerElement.clientWidth;i.push(s/t)}return i}setRatios(e){let t=this.stackedVertical?this.spiltterBars[0].barElement.clientHeight:this.spiltterBars[0].barElement.clientWidth,i=(this.stackedVertical?this.panelElement.clientHeight:this.panelElement.clientWidth)-t*this.spiltterBars.length;for(let t=0;t<this.childContainers.length;t++){let n=this.childContainers[t],s=i*e[t];this.stackedVertical?n.resize(n.width,Math.floor(s)):n.resize(Math.floor(s),n.height)}}resize(e,t){if(this.childContainers.length<=1)return;let i;for(i=0;i<this.childContainers.length;i++){let n=this.childContainers[i];if(this.stackedVertical?n.resize(e,n.height?n.height:t):n.resize(n.width?n.width:e,t),i<this.spiltterBars.length){let n=this.spiltterBars[i];this.stackedVertical?n.barElement.style.width=e+"px":n.barElement.style.height=t+"px"}}let n=0;this.childContainers.forEach((e=>{let t=this.stackedVertical?e.height:e.width;n+=t}));const s=this.spiltterBars[0].barElement.getBoundingClientRect();let o=this.stackedVertical?s.height:s.width,l=this.stackedVertical?t:e;l-=o*this.spiltterBars.length,n=Math.max(n,1);let a=l/n,h=0;for(i=0;i<this.childContainers.length;i++){let e=this.childContainers[i];"none"==e.containerElement.style.display&&(e.containerElement.style.display="block");let t=this.stackedVertical?e.containerElement.clientHeight:e.containerElement.clientWidth,n=a>1?Math.floor(t*a):Math.ceil(t*a);h+=n,i===this.childContainers.length-1&&(n+=l-h),this.stackedVertical?e.resize(e.width,n):e.resize(n,e.height)}this.panelElement.style.width=e+"px",this.panelElement.style.height=t+"px"}}class k{constructor(e,t,i,n){0!==arguments.length&&(this.name=e,this.dockManager=t,this.stackedVertical=n,this.splitterPanel=new w(i,this.stackedVertical),this.containerElement=this.splitterPanel.panelElement,this.minimumAllowedChildNodes=2)}resize(e,t){this.splitterPanel.resize(e,t),this._cachedWidth=e,this._cachedHeight=t}performLayout(e,t=!1){this.splitterPanel.performLayout(e,t)}setActiveChild(){}destroy(){this.splitterPanel.destroy()}setContainerRatio(e,t){this.splitterPanel.setContainerRatio(e,t),this.resize(this.width,this.height)}getRatios(){return this.splitterPanel.getRatios()}setRatios(e){this.splitterPanel.setRatios(e),this.resize(this.width,this.height)}saveState(e){e.width=this.width,e.height=this.height}loadState(e){this.state={width:e.width,height:e.height}}get width(){return void 0===this._cachedWidth&&(this._cachedWidth=this.splitterPanel.panelElement.clientWidth),this._cachedWidth}get height(){return void 0===this._cachedHeight&&(this._cachedHeight=this.splitterPanel.panelElement.clientHeight),this._cachedHeight}}class y extends k{constructor(t,i){super(a.getNextId("horizontal_splitter_"),t,i,!1),this.containerType=e.horizontal}}class b extends k{constructor(t,i){super(a.getNextId("vertical_splitter_"),t,i,!0),this.containerType=e.vertical}}class E{constructor(e){this.parent=e;let t=this._performUndock.bind(this);this.elementBase=document.createElement("div"),this.elementText=document.createElement("div"),this.elementCloseButton=document.createElement("div"),this.elementBase.classList.add("dockspan-tab-handle"),this.elementBase.classList.add("disable-selection"),this.elementText.classList.add("dockspan-tab-handle-text"),this.elementCloseButton.classList.add("dockspan-tab-handle-close-button"),this.elementBase.appendChild(this.elementText),this.parent.host.displayCloseButton&&this.elementBase.appendChild(this.elementCloseButton),this.parent.container._hideCloseButton&&(this.elementCloseButton.style.display="none"),this.parent.host.tabListElement.appendChild(this.elementBase);let i=e.container,n=i.getRawTitle();this.undockListener={onDockEnabled:e=>{this.undockEnabled(e.state)},onHideCloseButton:e=>{this.hideCloseButton(e.state)}},this.eventListeners=[],i.addListener(this.undockListener),this.elementText.innerHTML=n,this.elementText.title=this.elementText.innerText,this._bringToFront(this.elementBase),this.undockInitiator=new r(this.elementBase,t),this.undockInitiator.enabled=!0,this.mouseDownHandler=new h(this.elementBase,"mousedown",this.onMouseDown.bind(this)),this.touchDownHandler=new h(this.elementBase,"touchstart",this.onMouseDown.bind(this),{passive:!1}),this.closeButtonHandler=new h(this.elementCloseButton,"click",this.onCloseButtonClicked.bind(this)),this.closeButtonTouchHandler=new h(this.elementCloseButton,"touchstart",this.onCloseButtonClicked.bind(this)),this.auxClickHandler=new h(this.elementBase,"auxclick",this.onCloseButtonClicked.bind(this)),this.contextMenuHandler=new h(this.elementBase,"contextmenu",this.oncontextMenuClicked.bind(this)),this.zIndexCounter=e.host.dockManager.zIndexTabHandle}addListener(e){this.eventListeners.push(e)}removeListener(e){this.eventListeners.splice(this.eventListeners.indexOf(e),1)}undockEnabled(e){this.undockInitiator.enabled=e}oncontextMenuClicked(e){e.preventDefault(),!this._ctxMenu&&E.createContextMenuContentCallback?(this._ctxMenu=document.createElement("div"),this._ctxMenu.className="dockspab-tab-handle-context-menu",E.createContextMenuContentCallback(this,this._ctxMenu,this.parent.container.dockManager.context.model.documentManagerNode.children),this._ctxMenu.style.left=e.pageX+"px",this._ctxMenu.style.top=e.pageY+"px",document.body.appendChild(this._ctxMenu),this._windowsContextMenuCloseBound=this.windowsContextMenuClose.bind(this),window.addEventListener("mouseup",this._windowsContextMenuCloseBound)):this.closeContextMenu()}closeContextMenu(){this._ctxMenu&&(document.body.removeChild(this._ctxMenu),delete this._ctxMenu,window.removeEventListener("mouseup",this._windowsContextMenuCloseBound))}windowsContextMenuClose(e){let t=e.composedPath();for(let e in t)if(t[e]==this._ctxMenu)return;this.closeContextMenu()}onMouseDown(e){e.preventDefault(),this.parent.onSelected(),this.mouseMoveHandler&&(this.mouseMoveHandler.cancel(),delete this.mouseMoveHandler),this.touchMoveHandler&&(this.touchMoveHandler.cancel(),delete this.touchMoveHandler),this.mouseUpHandler&&(this.mouseUpHandler.cancel(),delete this.mouseUpHandler),this.touchUpHandler&&(this.touchUpHandler.cancel(),delete this.touchUpHandler),this.stargDragPosition=e.clientX,this.mouseMoveHandler=new h(window,"mousemove",this.onMouseMove.bind(this)),this.touchMoveHandler=new h(window,"touchmove",this.onMouseMove.bind(this),{passive:!1}),this.mouseUpHandler=new h(window,"mouseup",this.onMouseUp.bind(this)),this.touchUpHandler=new h(window,"touchend",this.onMouseUp.bind(this))}onMouseUp(e){this.elementBase&&this.elementBase.classList.remove("dockspan-tab-handle-dragged"),this.dragged=!1,this.mouseMoveHandler&&this.mouseMoveHandler.cancel(),this.touchMoveHandler&&this.touchMoveHandler.cancel(),this.mouseUpHandler&&this.mouseUpHandler.cancel(),this.touchUpHandler&&this.touchUpHandler.cancel(),delete this.mouseMoveHandler,delete this.touchMoveHandler,delete this.mouseUpHandler,delete this.touchUpHandler}moveTabEvent(e,t){e.eventListeners.forEach((i=>{i.onMoveTab&&i.onMoveTab({self:e,state:t})}))}onMouseMove(e){if(e.preventDefault(),!(Math.abs(this.stargDragPosition-e.clientX)<10)&&null!=this.elementBase){this.elementBase.classList.add("dockspan-tab-handle-dragged"),this.dragged=!0,this.prev=this.current,this.current=e.clientX,this.direction=this.current-this.prev;let t=this.elementBase.getBoundingClientRect(),i=this.direction<0?{state:"left",bound:t.left,rect:t}:{state:"right",bound:t.right,rect:t};(e.clientX<t.left&&this.direction<0||e.clientX>t.left+t.width&&this.direction>0)&&this.moveTabEvent(this,i.state)}}hideCloseButton(e){this.elementCloseButton.style.display=e?"none":"block"}updateTitle(){if(this.parent.container instanceof d){let e=this.parent.container.getRawTitle();this.elementText.innerHTML=e}}destroy(){this.parent.container.removeListener(this.undockListener),this.mouseDownHandler.cancel(),this.touchDownHandler.cancel(),this.closeButtonHandler.cancel(),this.closeButtonTouchHandler.cancel(),this.auxClickHandler.cancel(),this.mouseMoveHandler&&this.mouseMoveHandler.cancel(),this.touchMoveHandler&&this.touchMoveHandler.cancel(),this.mouseUpHandler&&this.mouseUpHandler.cancel(),this.touchUpHandler&&this.touchUpHandler.cancel(),this.contextMenuHandler&&this.contextMenuHandler.cancel(),a.removeNode(this.elementBase),a.removeNode(this.elementCloseButton),delete this.elementBase,delete this.elementCloseButton}_performUndock(e,t){return"panel"===this.parent.container.containerType?(this.undockInitiator.enabled=!1,this.parent.container.performUndockToDialog(e,t)):null}onCloseButtonClicked(e){"none"!==this.elementCloseButton.style.display&&2!==e.button&&"panel"===this.parent.container.containerType&&this.parent.container.close()}setSelected(e){e?this.elementBase.classList.add("dockspan-tab-handle-selected"):(this.elementBase.classList.remove("dockspan-tab-handle-selected"),this.elementBase.classList.remove("dockspan-tab-handle-active"))}setActive(e){this.elementBase&&(e?this.elementBase.classList.add("dockspan-tab-handle-active"):this.elementBase.classList.remove("dockspan-tab-handle-active"))}setZIndex(e){this.elementBase.style.zIndex=e}_bringToFront(e){e.style.zIndex=this.zIndexCounter,this.zIndexCounter++}}E.createContextMenuContentCallback=(e,i,n)=>{let s=document.createElement("div");s.innerText="Close all documents",i.append(s);let o=document.createElement("div");o.innerText="Close all documents but this",i.append(o),s.onclick=()=>{for(let e=n.length-1;e>=0;e--){let i=n[e].container;i.panelType==t.document&&i.close()}e.closeContextMenu()},o.onclick=()=>{for(let i=n.length-1;i>=0;i--){let s=n[i].container;e.parent.container!=s&&s.panelType==t.document&&s.close()}e.closeContextMenu()}};class H{constructor(e,t){0!==arguments.length&&(this.selected=!1,this.host=e,this.container=t,this.handle=new E(this),this.containerElement=t.containerElement,t instanceof d&&(this.panel=t,this.panel.onTitleChanged=this.onTitleChanged.bind(this)),t.tabPage=this)}onTitleChanged(){this.handle.updateTitle()}destroy(){this.handle.destroy(),this.container instanceof d&&delete this.container.onTitleChanged,this.host.dockManager.activePanel==this.panel&&(this.host.dockManager.activePanel=null),this.container.tabPage=null,a.removeNode(this.containerElement)}onSelected(){this.host.onTabPageSelected(this),this.container instanceof d&&this.container.dockManager.notifyOnTabChange(this)}setSelected(e){if(this.selected=e,this.handle.setSelected(e),this._initContent||this.host.contentElement.appendChild(this.containerElement),this._initContent=!0,this.selected){this.containerElement.style.display="block";let e=this.host.contentElement.clientWidth,t=this.host.contentElement.clientHeight;this.container.resize(e,t),this.host.dockManager.activePanel=this.container}else this.containerElement.style.display="none"}resize(e,t){this.container.resize(e,t)}}!function(e){e[e.TOP=0]="TOP",e[e.BOTTOM=1]="BOTTOM",e[e.LEFT=2]="LEFT",e[e.RIGHT=3]="RIGHT"}(i||(i={}));class C{constructor(e,t,n){if(void 0===t&&(t=i.BOTTOM),void 0===n&&(n=!1),this.dockManager=e,this.tabStripDirection=t,this.displayCloseButton=n,this.pages=[],this.eventListeners=[],this.tabHandleListener={onMoveTab:e=>{this.onMoveTab(e)}},this.hostElement=document.createElement("div"),this.tabListElement=document.createElement("div"),this.separatorElement=document.createElement("div"),this.contentElement=document.createElement("div"),this.contentElement.tabIndex=0,this.createTabPage=this._createDefaultTabPage,this.tabStripDirection===i.BOTTOM)this.hostElement.appendChild(this.contentElement),this.hostElement.appendChild(this.separatorElement),this.hostElement.appendChild(this.tabListElement);else{if(this.tabStripDirection!==i.TOP)throw new Error("Only top and bottom tab strip orientations are supported");this.hostElement.appendChild(this.tabListElement),this.hostElement.appendChild(this.separatorElement),this.hostElement.appendChild(this.contentElement)}this.hostElement.classList.add("dockspan-tab-host"),this.tabListElement.classList.add("dockspan-tab-handle-list-container"),this.separatorElement.classList.add("dockspan-tab-handle-content-seperator"),this.contentElement.classList.add("dockspan-tab-content"),this.contentElement.tabIndex=0,this.focusHandler=new h(this.contentElement,"focus",this.onFocus.bind(this),!0),this.mouseDownHandler=new h(this.contentElement,"mousedown",this.onMousedown.bind(this),!0)}onFocus(){this.activeTab&&this.dockManager.activePanel!=this.activeTab.panel&&(this.dockManager.activePanel=this.activeTab.panel)}setActive(e){e?this.separatorElement.classList.add("dockspan-tab-handle-content-seperator-active"):this.separatorElement.classList.remove("dockspan-tab-handle-content-seperator-active"),this.activeTab&&this.activeTab.handle.setActive(e)}onMousedown(){this.activeTab&&this.dockManager.activePanel!=this.activeTab.panel&&(this.dockManager.activePanel=this.activeTab.panel)}onMoveTab(e){let t=Array.prototype.slice.call(this.tabListElement.childNodes).indexOf(e.self.elementBase);this.change(this,e.self,e.state,t)}performTabsLayout(e){this.pages=a.orderByIndexes(this.pages,e);let t=this.tabListElement.childNodes,i=[];for(let e in t)1===t[e].nodeType&&i.push(t[e]);i=a.orderByIndexes(i,e);for(let e=0;e<i.length;++e)this.tabListElement.appendChild(i[e]);this.activeTab&&this.onTabPageSelected(this.activeTab)}getActiveTab(){return this.activeTab}addListener(e){this.eventListeners.push(e)}removeListener(e){this.eventListeners.splice(this.eventListeners.indexOf(e),1)}change(e,t,i,n){this.eventListeners.forEach((s=>{s.onChange&&s.onChange({host:e,handle:t,state:i,index:n})}))}_createDefaultTabPage(e,t){return new H(e,t)}setActiveTab(e){let t;this.pages.forEach((i=>{i.container===e&&(t=i)})),this.pages.length>0&&t&&(this.onTabPageSelected(t),this.dockManager.activePanel=e)}resize(e,t){this.hostElement.style.width=e+"px",this.hostElement.style.height=t+"px";let i=this.tabListElement.clientHeight;this._resizeRequested||requestAnimationFrame((()=>this.resizeTabListElement(e,t))),this._resizeRequested=!0;let n=this.separatorElement.clientHeight,s=t-i-n;this.contentElement.style.height=s+"px",this.activeTab&&this.activeTab.resize(e,s)}resizeTabListElement(e,t){if(this._resizeRequested=!1,0===this.pages.length)return;let i=0;this.pages.forEach((e=>{let t=e.handle;t.elementBase.style.width="",i+=t.elementBase.clientWidth}));let n=e/i;n>1.2||this.pages.forEach(((e,t)=>{let i=e.handle,s=n*i.elementBase.clientWidth;t===this.pages.length-1&&(s-=5),i.elementBase.style.width=s+"px"}))}performLayout(e){this.pages.forEach((t=>{if(!e.some((e=>e==t.container))){t.handle.removeListener(this.tabHandleListener),t.destroy();let e=this.pages.indexOf(t);e>-1&&this.pages.splice(e,1)}}));let t=this.activeTab;delete this.activeTab;let i=e.filter((e=>"panel"===e.containerType));i.length>0?(i.forEach((e=>{let i=null;this.pages.some((t=>t.container==e&&(i=t,!0)))||(i=this.createTabPage(this,e),i.handle.addListener(this.tabHandleListener),this.pages.push(i)),t&&i.container===t.container&&(this.activeTab=i)})),this._setTabHandlesVisible(!0)):this._setTabHandlesVisible(!1),this.activeTab&&this.onTabPageSelected(this.activeTab)}_setTabHandlesVisible(e){e?(this.tabListElement.classList.add("dockspan-tab-handle-list-container-visible"),this.separatorElement.classList.add("dockspan-tab-handle-content-seperator-visible")):(this.tabListElement.classList.remove("dockspan-tab-handle-list-container-visible"),this.separatorElement.classList.remove("dockspan-tab-handle-content-seperator-visible"))}onTabPageSelected(e){this.activeTab=e,this.pages.forEach((t=>{let i=t===e;t.setSelected(i)}));let t=1,i=this.dockManager.zIndexTabHost;this.pages.forEach((n=>{n.handle.setZIndex(i),n===e&&(t=-1),i+=t}))}}class D{constructor(t,n){void 0===n&&(n=i.BOTTOM),this.dockManager=t,this.tabOrientation=n,this.name=a.getNextId("fill_"),this.element=document.createElement("div"),this.containerElement=this.element,this.containerType=e.fill,this.minimumAllowedChildNodes=2,this.element.classList.add("dock-container"),this.element.classList.add("dock-container-fill"),this.tabHost=new C(t,this.tabOrientation),this.tabHostListener={onChange:e=>{this.dockManager._requestTabReorder(this,e)}},this.tabHost.addListener(this.tabHostListener),this.element.appendChild(this.tabHost.hostElement)}setActiveChild(e){this.tabHost.setActiveTab(e)}resize(e,t){this.element.style.width=e+"px",this.element.style.height=t+"px",this.tabHost.resize(e,t)}performLayout(e){this.tabHost.performLayout(e)}destroy(){a.removeNode(this.element)&&delete this.element}saveState(e){e.width=this.width,e.height=this.height}loadState(e){this.state={width:e.width,height:e.height}}get width(){return this.element.clientWidth}set width(e){this.element.style.width=e+"px"}get height(){return this.element.clientHeight}set height(e){this.element.style.height=e+"px"}}class x{constructor(e){this._forceResizeCompositeContainer=e=>{let t=e.containerElement.clientWidth,i=e.containerElement.clientHeight;e.resize(t,i)},this.dockManager=e}dockLeft(e,t){this._performDock(e,t,"horizontal",!0)}dockRight(e,t){this._performDock(e,t,"horizontal",!1)}dockUp(e,t){this._performDock(e,t,"vertical",!0)}dockDown(e,t){this._performDock(e,t,"vertical",!1)}dockFill(e,t){this._performDock(e,t,"fill",!1)}undock(e){let t=e.parent;if(!t)throw new Error("Cannot undock.  panel is not a leaf node");let i=t.children.indexOf(e);if(e.detachFromParent(),t.children.length<t.container.minimumAllowedChildNodes){let e=t.parent;for(let i=0;i<t.children.length;i++){let n=t.children[i];if(e){e.addChildAfter(t,n),t.detachFromParent();let i=t.container.containerElement.clientWidth,s=t.container.containerElement.clientHeight;t.container.destroy(),n.container.resize(i,s),e.performLayout(!1)}else t.detachFromParent(),t.container.destroy(),this.dockManager.setRootNode(n)}}else if(t.performLayout(!1),t.children.length>0){let e=t.children[Math.max(0,i-1)];t.container.setActiveChild(e.container)}this.dockManager.invalidate(),this.dockManager.notifyOnUnDock(e)}close(e){let t=e.parent;if(!t)throw new Error("Cannot undock.  panel is not a leaf node");let i=!1;t.children.length>0&&null!=t.container.tabHost&&(i=t.container.tabHost.getActiveTab().container==e.container);let n=t.children.indexOf(e);if(e.detachFromParent(),t.children.length<t.container.minimumAllowedChildNodes){let e=t.parent;for(let i=0;i<t.children.length;i++){let n=t.children[i];if(e){e.addChildAfter(t,n),t.detachFromParent();let i=t.container.containerElement.clientWidth,s=t.container.containerElement.clientHeight;n.container.resize(i,s),t.container.destroy(),e.performLayout(!1)}else t.detachFromParent(),t.container.destroy(),this.dockManager.setRootNode(n)}}else if(t.performLayout(!1),i){let e=t.children[Math.max(0,n-1)];null!=e&&t.container.setActiveChild(e.container)}this.dockManager.invalidate(),this.dockManager.notifyOnUnDock(e)}reorderTabs(e,t,i,n){if(null!=e){let t=e.children.length,s="left"===i?n:n+1;if("right"==i&&s>=e.children.length)return;if("left"==i&&0==s)return;let o=Array.apply(null,{length:t}).map(Number.call,Number),l=o.splice(s,1)[0];o.splice("left"===i?n-1:n,0,l),e.children=a.orderByIndexes(e.children,o),e.container.tabHost.performTabsLayout(o),this.dockManager.notifyOnTabsReorder(e)}}_performDock(e,t,i,n){if(e.parent&&"fill"===e.parent.container.containerType&&(e=e.parent),"fill"===i&&"fill"===e.container.containerType)return e.addChild(t),e.performLayout(!1),e.container.setActiveChild(t.container),this.dockManager.invalidate(),void this.dockManager.notifyOnDock(t);let s,o,l;if(e===this.dockManager.context.model.rootNode)return n?(s=this._createDockContainer(i,t,e),o=new f(s),o.addChild(t),o.addChild(e)):(s=this._createDockContainer(i,e,t),o=new f(s),o.addChild(e),o.addChild(t)),this.dockManager.setRootNode(o),this.dockManager.rebuildLayout(this.dockManager.context.model.rootNode),o.container.setActiveChild(t.container),this.dockManager.invalidate(),void this.dockManager.notifyOnDock(t);if(e.parent.container.containerType!==i){l=e.parent;let h=e.container.containerElement.clientWidth,r=e.container.containerElement.clientHeight,d=l.container.containerElement.clientWidth,c=l.container.containerElement.clientHeight;s=this._createDockContainer(i,t,e),o=new f(s),l.addChildAfter(e,o),e.detachFromParent(),a.removeNode(e.container.containerElement),n?(o.addChild(t),o.addChild(e)):(o.addChild(e),o.addChild(t)),l.performLayout(!1),o.performLayout(!0),o.container.setActiveChild(t.container),o.container.resize(h,r),l.container.resize(d,c)}else l=e.parent,n?l.addChildBefore(e,t):l.addChildAfter(e,t),l.performLayout(!1),l.container.setActiveChild(t.container);let h=t.container.containerElement.clientWidth,r=t.container.containerElement.clientHeight;t.container.resize(h,r),this.dockManager.invalidate(),this.dockManager.notifyOnDock(t)}_createDockContainer(e,t,i){if("horizontal"===e)return new y(this.dockManager,[t.container,i.container]);if("vertical"===e)return new b(this.dockManager,[t.container,i.container]);if("fill"===e)return new D(this.dockManager);throw new Error("Failed to create dock container of type: "+e)}getDockBounds(e,t,i,n){let s,o,l,a;if("fill"===i){let t=e.container.containerElement,i=this.dockManager.element.getBoundingClientRect(),n=t.getBoundingClientRect();return{x:n.left-i.left,y:n.top-i.top,width:t.clientWidth,height:t.clientHeight}}e.parent&&"fill"===e.parent.container.containerType&&(e=e.parent);let h=!1;e.parent&&e.parent.container.containerType===i?(s=e.parent,o=s.children.length,l=s.children.indexOf(e)+(n?0:1)):(s=e,o=1,l=n?0:1,h=!0);let r=0,d=0;if("vertical"===i||"horizontal"===i){let e=this._getVaringDimension(s.container,i)-5*(o-1),a=this._getVaringDimension(t,i),c=e/(e+a);if(r=a*c,h)d=n?0:e*c;else{for(let e=0;e<l;e++)d+=this._getVaringDimension(s.children[e].container,i);d*=c}}a={};let c=this.dockManager.element.getBoundingClientRect(),u=s.container.containerElement.getBoundingClientRect();return"vertical"===i?(a.x=u.left-c.left,a.y=u.top-c.top+d,a.width=s.container.width,a.height=r):"horizontal"===i&&(a.x=u.left-c.left+d,a.y=u.top-c.top,a.width=r,a.height=s.container.height),a}_getVaringDimension(e,t){return"vertical"===t?e.height:"horizontal"===t?e.width:0}}class T{constructor(e,t){this.wheel=e,this.id=t;let i=t.replace("-s","");this.element=document.createElement("div"),this.element.classList.add("dock-wheel-item"),this.element.classList.add("disable-selection"),this.element.classList.add("dock-wheel-"+i),this.element.classList.add("dock-wheel-"+i+"-icon"),this.hoverIconClass="dock-wheel-"+i+"-icon-hover",this.mouseOverHandler=new h(this.element,"mouseover",this.onMouseMoved.bind(this)),this.mouseOutHandler=new h(this.element,"mouseout",this.onMouseOut.bind(this)),this.active=!1}onMouseMoved(){this.active=!0,this.element.classList.add(this.hoverIconClass),this.wheel.onMouseOver(this)}onMouseOut(){this.active=!1,this.element.classList.remove(this.hoverIconClass),this.wheel.onMouseOut()}}!function(e){e.left="left",e.right="right",e.top="top",e.down="down",e.fill="fill",e["left-s"]="left-s",e["right-s"]="right-s",e["top-s"]="top-s",e["down-s"]="down-s"}(n||(n={}));class _{constructor(e){this.dockManager=e,this.elementMainWheel=document.createElement("div"),this.elementSideWheel=document.createElement("div"),this.wheelItems={};for(let e in n)this.wheelItems[e]=new T(this,e),"-s"===e.substr(-2,2)?this.elementSideWheel.appendChild(this.wheelItems[e].element):this.elementMainWheel.appendChild(this.wheelItems[e].element);this.elementMainWheel.classList.add("dock-wheel-base"),this.elementSideWheel.classList.add("dock-wheel-base"),this.elementMainWheel.style.zIndex=String(9000001),this.elementSideWheel.style.zIndex=String(9e6),this.elementPanelPreview=document.createElement("div"),this.elementPanelPreview.classList.add("dock-wheel-panel-preview"),this.elementPanelPreview.style.zIndex=String(8999999),this.activeDialog=void 0,this._activeNode=void 0,this._visible=!1}get activeNode(){return this._activeNode}set activeNode(e){let t=this._activeNode;this._activeNode=e,t!==this._activeNode&&this._visible&&this.showWheel()}showWheel(){if(this._visible=!0,!this.activeNode)return a.removeNode(this.elementMainWheel),void a.removeNode(this.elementSideWheel);let e=this.activeNode.container.containerElement,t=e.clientWidth,i=e.clientHeight,s=Math.floor(t/2),o=Math.floor(i/2),l=e.getBoundingClientRect(),h=this.dockManager.element.getBoundingClientRect();this.elementMainWheel.style.left=l.left-h.left+s+"px",this.elementMainWheel.style.top=l.top-h.top+o+"px";let r=this.dockManager.element.clientWidth,d=this.dockManager.element.clientHeight;a.removeNode(this.elementMainWheel),a.removeNode(this.elementSideWheel),this.dockManager.element.appendChild(this.elementMainWheel),this.dockManager.element.appendChild(this.elementSideWheel),this._setWheelButtonPosition(n["left-s"],20,-d/2),this._setWheelButtonPosition(n["right-s"],r-40,-d/2),this._setWheelButtonPosition(n["top-s"],r/2,20-d),this._setWheelButtonPosition(n["down-s"],r/2,-20)}_setWheelButtonPosition(e,t,i){let n=this.wheelItems[e],s=n.element.clientWidth/2,o=n.element.clientHeight/2,l=Math.floor(t-s),a=Math.floor(i-o);n.element.style.marginLeft=l+"px",n.element.style.marginTop=a+"px"}hideWheel(){this._visible=!1,this.activeNode=void 0,a.removeNode(this.elementMainWheel),a.removeNode(this.elementSideWheel),a.removeNode(this.elementPanelPreview);for(let e in this.wheelItems)this.wheelItems[e].active=!1}onMouseOver(e){if(!this.activeDialog)return;let t,i=this.dockManager.context.model.rootNode;e.id===n.top?t=this.dockManager.layoutEngine.getDockBounds(this.activeNode,this.activeDialog.panel,"vertical",!0):e.id===n.down?t=this.dockManager.layoutEngine.getDockBounds(this.activeNode,this.activeDialog.panel,"vertical",!1):e.id===n.left?t=this.dockManager.layoutEngine.getDockBounds(this.activeNode,this.activeDialog.panel,"horizontal",!0):e.id===n.right?t=this.dockManager.layoutEngine.getDockBounds(this.activeNode,this.activeDialog.panel,"horizontal",!1):e.id===n.fill?t=this.dockManager.layoutEngine.getDockBounds(this.activeNode,this.activeDialog.panel,"fill",!1):e.id===n["top-s"]?t=this.dockManager.layoutEngine.getDockBounds(i,this.activeDialog.panel,"vertical",!0):e.id===n["down-s"]?t=this.dockManager.layoutEngine.getDockBounds(i,this.activeDialog.panel,"vertical",!1):e.id===n["left-s"]?t=this.dockManager.layoutEngine.getDockBounds(i,this.activeDialog.panel,"horizontal",!0):e.id===n["right-s"]&&(t=this.dockManager.layoutEngine.getDockBounds(i,this.activeDialog.panel,"horizontal",!1)),t&&(this.dockManager.element.appendChild(this.elementPanelPreview),this.elementPanelPreview.style.left=Math.round(t.x)+"px",this.elementPanelPreview.style.top=Math.round(t.y)+"px",this.elementPanelPreview.style.width=Math.round(t.width)+"px",this.elementPanelPreview.style.height=Math.round(t.height)+"px")}onMouseOut(){a.removeNode(this.elementPanelPreview)}onDialogDropped(e){let t=this._getActiveWheelItem();t&&this._handleDockRequest(t,e)}_getActiveWheelItem(){for(let e in this.wheelItems){let t=this.wheelItems[e];if(t.active)return t}}_handleDockRequest(e,t){e.active=!1,e.element.classList.remove(e.hoverIconClass),this.activeNode&&(e.id===n.left?this.dockManager.dockDialogLeft(this.activeNode,t):e.id===n.right?this.dockManager.dockDialogRight(this.activeNode,t):e.id===n.top?this.dockManager.dockDialogUp(this.activeNode,t):e.id===n.down?this.dockManager.dockDialogDown(this.activeNode,t):e.id===n.fill?this.dockManager.dockDialogFill(this.activeNode,t):e.id===n["left-s"]?this.dockManager.dockDialogLeft(this.dockManager.context.model.rootNode,t):e.id===n["right-s"]?this.dockManager.dockDialogRight(this.dockManager.context.model.rootNode,t):e.id===n["top-s"]?this.dockManager.dockDialogUp(this.dockManager.context.model.rootNode,t):e.id===n["down-s"]&&this.dockManager.dockDialogDown(this.dockManager.context.model.rootNode,t))}}class P{constructor(){this.rootNode=this.documentManagerNode=void 0}}class L extends H{constructor(e,t){super(e,t),"panel"===this.container.containerType&&(this.panel=t,this.containerElement=this.panel.elementContent,a.removeNode(this.containerElement))}destroy(){super.destroy(),this.panel.elementContentHost.appendChild(this.containerElement)}}class B extends D{constructor(e){super(e,i.TOP),this.minimumAllowedChildNodes=0,this.element.classList.add("document-manager"),this.tabHost.createTabPage=this._createDocumentTabPage,this.tabHost.displayCloseButton=!0}_createDocumentTabPage(e,t){return new L(e,t)}saveState(e){super.saveState(e),e.documentManager=!0}selectedTab(){return this.tabHost.activeTab}}class z{constructor(e){this.dockManager=e,this.model=new P,this.documentManagerView=new B(this.dockManager)}}class N{constructor(e){this.dockManager=e}deserialize(e){let t=JSON.parse(e),i=new P;return i.rootNode=this._buildGraph(t.graphInfo),i.dialogs=this._buildDialogs(t.dialogsInfo),i.documentManagerNode=this.documentManagerNode,i}_buildGraph(e){let t=e.children,i=[];t.forEach((e=>{let t=this._buildGraph(e);null!==t&&i.push(t)}));let n=this._createContainer(e,i);if(null===n)return null;let s=new f(n);return n instanceof B&&(this.documentManagerNode=s),s.children=i,s.children.reverse().forEach((e=>{e.parent=s})),s.children.reverse(),s}_createContainer(e,t){let i,n=e.containerType,s=e.state,o=[];if(t.forEach((e=>{o.push(e.container)})),"panel"===n){if(i=d.loadFromState(s,this.dockManager),!i.prepareForDocking)return null;i.prepareForDocking(),a.removeNode(i.elementPanel)}else if("horizontal"===n)i=new y(this.dockManager,o);else if("vertical"===n)i=new b(this.dockManager,o);else{if("fill"!==n)throw new Error("Cannot create dock container of unknown type: "+n);i=s.documentManager?new B(this.dockManager):new D(this.dockManager)}return i.loadState(s),i}_buildDialogs(e){let t=[];return e.forEach((e=>{let i,n=e.containerType,s=e.state;if("panel"===n&&(i=d.loadFromState(s,this.dockManager),i.prepareForDocking)){a.removeNode(i.elementPanel),i.isDialog=!0;let n=new g(i,this.dockManager);(e.position.x>document.body.clientWidth||e.position.y>document.body.clientHeight-70)&&(e.position.x=20,e.position.y=70),n.setPosition(e.position.x,e.position.y),n.isHidden=e.isHidden,n.isHidden&&n.hide(),t.push(n)}})),t}}class U{constructor(e,t){if(void 0===e)throw new Error("Invalid Dock Manager element provided");this._config=Object.assign(new p,t),this.element=e,this.context=this.dockWheel=this.layoutEngine=this.mouseMoveHandler=this.touchMoveHandler=void 0,this.layoutEventListeners=[],this.defaultDialogPosition=new l(0,0)}get config(){return this._config}initialize(){this.backgroundContext=this.element.children[0],this.context=new z(this);let e=new f(this.context.documentManagerView);this.context.model.rootNode=e,this.context.model.documentManagerNode=e,this.context.model.dialogs=[],this.setRootNode(this.context.model.rootNode),this.resize(this.element.clientWidth,this.element.clientHeight),this.dockWheel=new _(this),this.layoutEngine=new x(this),this._undockEnabled=!0,this.rebuildLayout(this.context.model.rootNode),this.zIndexCounter=1001,this.zIndexTabHost=1e3,this.zIndexTabHandle=100,this.zIndexDialogCounter=10001,null!=this.backgroundContext&&this.context.model.rootNode.container.tabHost.hostElement.insertBefore(this.backgroundContext,this.context.model.rootNode.container.tabHost.hostElement.firstChild),this.onKeyPressBound=this.onKeyPress.bind(this),this.element.addEventListener("keydown",this.onKeyPressBound)}onKeyPress(e){if("Escape"==e.key&&this.activePanel&&!this.activePanel._hideCloseButton&&(this.activePanel.isDialog&&this._config.escClosesDialog||!this.activePanel.isDialog&&this._config.escClosesWindow)){let e=this.activePanel;this.activePanel=null,e.close()}}checkXBounds(e,t,i,n,s){if(this._config.moveOnlyWithinDockConatiner)return this.checkXBoundsWithinDockContainer(e,t,i,n,s);let o=Math.floor(t.x-i.x),l=e.offsetLeft+e.offsetWidth+o<40,a=e.offsetLeft+o>window.innerWidth-40;if(l){i.x=t.x,o=0;let n=40-(e.offsetWidth+e.offsetLeft);n>0&&(o=n)}else if(a){i.x=t.x,o=0;let n=window.innerWidth-40-e.offsetLeft;n>0&&(o=n)}return o}checkXBoundsWithinDockContainer(e,t,i,n,s){let o=t.x-i.x,l=this.element.getBoundingClientRect(),a=e.getBoundingClientRect(),h=o<0&&a.left+o<l.left&&!s,r=o>0&&a.right+o>l.right&&!n;return h?(t.x-=o,o=l.left-a.left,t.x-=o):r&&(t.x-=o,o=l.right-a.right,t.x-=o),o}checkYBounds(e,t,i,n,s){if(this._config.moveOnlyWithinDockConatiner)return this.checkYBoundsWithinDockContainer(e,t,i,n,s);let o=Math.floor(t.y-i.y),l=e.offsetTop+o<0,a=e.offsetTop+o>window.innerHeight-16;if(l)i.y=t.y,o=0;else if(a){i.y=t.y,o=0;let n=window.innerHeight-25-e.offsetTop;n>0&&(o=n)}return o}checkYBoundsWithinDockContainer(e,t,i,n,s){let o=t.y-i.y,l=this.element.getBoundingClientRect(),a=e.getBoundingClientRect(),h=o<0&&a.top+o<l.top&&!s,r=o>0&&a.bottom+o>l.bottom&&!n;return h?(t.y-=o,o=l.top-a.top,t.y-=o):r&&(t.y-=o,o=l.bottom-a.bottom,t.y-=o),o}rebuildLayout(e){e.children.forEach((e=>{this.rebuildLayout(e)})),e.performLayout(!1)}invalidate(){this.resize(this.element.clientWidth,this.element.clientHeight)}resize(e,t){this.element.style.width=e+"px",this.element.style.height=t+"px",this.context.model.rootNode.container.resize(e,t)}setModel(e){a.removeNode(this.context.documentManagerView.containerElement),this.context.model=e,this.setRootNode(e.rootNode),this.rebuildLayout(e.rootNode),this.loadResize(e.rootNode)}loadResize(e){e.children.reverse().forEach((t=>{this.loadResize(t),e.container.setActiveChild(t.container)})),e.children.reverse();let t=e.container;e.container.resize(t.state.width,t.state.height)}setRootNode(e){e.detachFromParent(),this.context.model.rootNode=e,this.element.appendChild(e.container.containerElement)}_onDialogDragStarted(e,t){this.dockWheel.activeNode=this._findNodeOnPoint(t.clientX,t.clientY),this.dockWheel.activeDialog=e,null!=e.noDocking&&!0===e.noDocking||this.dockWheel.showWheel(),this.mouseMoveHandler&&(this.mouseMoveHandler.cancel(),delete this.mouseMoveHandler),this.touchMoveHandler&&(this.touchMoveHandler.cancel(),delete this.touchMoveHandler),this.mouseMoveHandler=new h(window,"mousemove",this._onMouseMoved.bind(this)),this.touchMoveHandler=new h(window,"touchmove",this._onMouseMoved.bind(this))}_onDialogDragEnded(e,t){this.mouseMoveHandler&&(this.mouseMoveHandler.cancel(),delete this.mouseMoveHandler),this.touchMoveHandler&&(this.touchMoveHandler.cancel(),delete this.touchMoveHandler),this.dockWheel.onDialogDropped(e),this.dockWheel.hideWheel(),delete this.dockWheel.activeDialog,e.saveState(e.elementDialog.offsetLeft,e.elementDialog.offsetTop)}_onMouseMoved(e){null!=e.changedTouches&&(e=e.changedTouches[0]),this.dockWheel.activeNode=this._findNodeOnPoint(e.clientX,e.clientY)}_findNodeOnPoint(e,t){let i,n=[];for(n.push(this.context.model.rootNode);n.length>0;){let s=n.pop();a.isPointInsideNode(e,t,s)&&(i=s,[].push.apply(n,s.children))}return i}dockDialogLeft(e,t){return this._requestDockDialog(e,t,this.layoutEngine.dockLeft.bind(this.layoutEngine))}dockDialogRight(e,t){return this._requestDockDialog(e,t,this.layoutEngine.dockRight.bind(this.layoutEngine))}dockDialogUp(e,t){return this._requestDockDialog(e,t,this.layoutEngine.dockUp.bind(this.layoutEngine))}dockDialogDown(e,t){return this._requestDockDialog(e,t,this.layoutEngine.dockDown.bind(this.layoutEngine))}dockDialogFill(e,t){return this._requestDockDialog(e,t,this.layoutEngine.dockFill.bind(this.layoutEngine))}dockLeft(e,t,i){return this._requestDockContainer(e,t,this.layoutEngine.dockLeft.bind(this.layoutEngine),!1,i)}dockRight(e,t,i){return this._requestDockContainer(e,t,this.layoutEngine.dockRight.bind(this.layoutEngine),!0,i)}dockUp(e,t,i){return this._requestDockContainer(e,t,this.layoutEngine.dockUp.bind(this.layoutEngine),!1,i)}dockDown(e,t,i){return this._requestDockContainer(e,t,this.layoutEngine.dockDown.bind(this.layoutEngine),!0,i)}dockFill(e,t){return this._requestDockContainer(e,t,this.layoutEngine.dockFill.bind(this.layoutEngine),!1)}floatDialog(e,t,i){let n;if(this.context.model.dialogs.forEach((s=>{e==s.panel&&(s.show(),s.setPosition(t,i),n=s)})),n)return n;try{let t=this._findNodeFromContainer(e);this.layoutEngine.undock(t)}catch(e){}let s=e;a.removeNode(s.elementPanel),s.isDialog=!0;let o=new g(s,this);return o.setPosition(t,i),o}_requestDockDialog(e,t,i){let n=t.panel,s=new f(n);return n.prepareForDocking(),t.destroy(),i(e,s),s}_checkShowBackgroundContext(){null!=this.backgroundContext&&(this.context.model.documentManagerNode.children.length>0?this.backgroundContext.style.display="none":this.backgroundContext.style.display="block")}_requestDockContainer(e,t,i,n,s){let o=new f(t);if("panel"===t.containerType){let e=t;e.prepareForDocking(),a.removeNode(e.elementPanel)}let l,h=null;if(e.parent&&e.parent.container&&(l=e.parent.container,l.getRatios&&(h=l.getRatios())),i(e,o),s&&o.parent&&("vertical"===o.parent.container.containerType||"horizontal"===o.parent.container.containerType)){let e=o.parent.container;h&&l==e?(n?(h[h.length-1]=h[h.length-1]-s,h.push(s)):(h[0]=h[0]-s,h.unshift(s)),e.setRatios(h)):e.setContainerRatio(t,s)}return this.rebuildLayout(this.context.model.rootNode),this.invalidate(),this._checkShowBackgroundContext(),o}_requestTabReorder(e,t){let i=this._findNodeFromContainer(e);this.layoutEngine.reorderTabs(i,t.handle,t.state,t.index)}requestUndockToDialog(e,t,i){let n=this._findNodeFromContainer(e);this.layoutEngine.undock(n);let s=n.container;s.elementPanel.style.display="block";let o=new g(s,this);if(void 0!==t){let e=o.elementDialog.clientWidth;i.x>e&&(i.x=.75*e),o.setPosition(t.clientX-i.x,t.clientY-i.y),o.draggable.onMouseDown(t)}return o}requestClose(e){let t=this._findNodeFromContainer(e);this.layoutEngine.close(t),this.activePanel==e&&(this.activePanel=null),this._activeDocument==e&&(this._activeDocument=null)}openInDialog(e,t,i){let n=new g(e,this);if(void 0!==t){let e=n.elementDialog.clientWidth;i.x>e&&(i.x=.75*e),n.setPosition(t.clientX-i.x,t.clientY-i.y),n.draggable.onMouseDown(t)}return n}requestUndock(e){let t=this._findNodeFromContainer(e);this.layoutEngine.undock(t)}requestRemove(e){let t=this._findNodeFromContainer(e),i=t.parent;return t.detachFromParent(),i&&this.rebuildLayout(i),t}getNodeByElementId(e){let t=[];for(t.push(this.context.model.rootNode);t.length>0;){let i=t.pop();if(i.container instanceof d&&i.container.elementContent.id===e)return i;[].push.apply(t,i.children)}return null}_findNodeFromContainer(e){let t=[];for(t.push(this.context.model.rootNode);t.length>0;){let i=t.pop();if(i.container===e)return i;[].push.apply(t,i.children)}return null}findNodeFromContainerElement(e){let t=[];for(t.push(this.context.model.rootNode);t.length>0;){let i=t.pop();if(i.container.containerElement===e)return i;[].push.apply(t,i.children)}return null}addLayoutListener(e){this.layoutEventListeners.push(e)}removeLayoutListener(e){this.layoutEventListeners.splice(this.layoutEventListeners.indexOf(e),1)}suspendLayout(e){this.layoutEventListeners.forEach((t=>{t.onSuspendLayout&&t.onSuspendLayout(this,e)}))}resumeLayout(e){this.layoutEventListeners.forEach((t=>{t.onResumeLayout&&t.onResumeLayout(this,e)}))}notifyOnDock(e){this._checkShowBackgroundContext(),this.layoutEventListeners.forEach((t=>{t.onDock&&t.onDock(this,e)}))}notifyOnTabsReorder(e){this.layoutEventListeners.forEach((t=>{t.onTabsReorder&&t.onTabsReorder(this,e)}))}notifyOnUnDock(e){this._checkShowBackgroundContext(),this.layoutEventListeners.forEach((t=>{t.onUndock&&t.onUndock(this,e)}))}notifyOnClosePanel(e){this._checkShowBackgroundContext(),this.layoutEventListeners.forEach((t=>{t.onClosePanel&&t.onClosePanel(this,e)})),this.activePanel==e&&(this.activePanel=null),this._activeDocument==e&&(this._activeDocument=null)}notifyOnCreateDialog(e){this.layoutEventListeners.forEach((t=>{t.onCreateDialog&&t.onCreateDialog(this,e)}))}notifyOnHideDialog(e){this.layoutEventListeners.forEach((t=>{t.onHideDialog&&t.onHideDialog(this,e)}))}notifyOnShowDialog(e){this.layoutEventListeners.forEach((t=>{t.onShowDialog&&t.onShowDialog(this,e)}))}notifyOnChangeDialogPosition(e,t,i){this.layoutEventListeners.forEach((n=>{n.onChangeDialogPosition&&n.onChangeDialogPosition(this,e,t,i)}))}notifyOnContainerResized(e){this.layoutEventListeners.forEach((t=>{t.onContainerResized&&t.onContainerResized(this,e)}))}notifyOnTabChange(e){this.layoutEventListeners.forEach((t=>{t.onTabChanged&&t.onTabChanged(this,e)}))}notifyOnActivePanelChange(e,t){this.layoutEventListeners.forEach((i=>{i.onActivePanelChange&&i.onActivePanelChange(this,e,t)}))}saveState(){return(new v).serialize(this.context.model)}loadState(e){let t=new N(this);this.context.model=t.deserialize(e),this.setModel(this.context.model)}getPanels(){let e=[];return this._allPanels(this.context.model.rootNode,e),this.context.model.dialogs.forEach((t=>{e.push(t.panel)})),e}undockEnabled(e){this._undockEnabled=e,this.getPanels().forEach((t=>{t.canUndock(e)}))}lockDockState(e){this.undockEnabled(!e),this.hideCloseButton(e)}hideCloseButton(e){this.getPanels().forEach((t=>{t.hideCloseButton(e)}))}updatePanels(e){let t=[];return this._allPanels(this.context.model.rootNode,t),t.forEach((t=>{a.arrayContains(e,t.elementContent.id)||t.close()})),this.context.model.dialogs.forEach((t=>{a.arrayContains(e,t.panel.elementContent.id)?t.show():t.hide()})),t}getVisiblePanels(){let e=[];return this._allPanels(this.context.model.rootNode,e),this.context.model.dialogs.forEach((t=>{t.isHidden||e.push(t.panel)})),e}_allPanels(e,t){e.children.forEach((e=>{this._allPanels(e,t)})),"panel"===e.container.containerType&&t.push(e.container)}get activeDocument(){return this._activeDocument}get activePanel(){return this._activePanel}set activePanel(e){if(e!==this._activePanel){e&&!e.isDialog&&(this._lastPanelNotADialog=e),this._lastPanelNotADialog&&this.getPanels().indexOf(this._lastPanelNotADialog)<0&&(this._lastPanelNotADialog=null);let i=this.activePanel;this.activePanel&&(this.activePanel.elementTitle.classList.remove("dockspan-panel-active"),this.activePanel.elementTitleText.classList.remove("dockspan-panel-titlebar-text-active"),this.activePanel.tabPage&&this.activePanel.tabPage.host.setActive(!1)),this._activePanel=e,e&&e.panelType==t.document&&(this._activeDocument=e),!e&&i&&i.isDialog&&null==e&&this._lastPanelNotADialog&&this.activePanel!=this._lastPanelNotADialog&&(e=this._lastPanelNotADialog,this._lastPanelNotADialog=void 0),this.notifyOnActivePanelChange(e,i),e&&(e.elementTitle.classList.add("dockspan-panel-active"),e.elementTitleText.classList.add("dockspan-panel-titlebar-text-active"),e.tabPage&&e.tabPage.host.setActive(!0))}else e&&e.tabPage&&e.tabPage.host.setActive(!0)}}DockSpawnTS=o})();